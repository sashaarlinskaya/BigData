# %% [markdown]
# # –õ–∞–±–æ—Ä–∞—Ç–æ—Ä–Ω–∞—è —Ä–∞–±–æ—Ç–∞ 4.1
# ## –°—Ä–∞–≤–Ω–µ–Ω–∏–µ –ø–æ–¥—Ö–æ–¥–æ–≤ —Ö—Ä–∞–Ω–µ–Ω–∏—è –±–æ–ª—å—à–∏—Ö –¥–∞–Ω–Ω—ã—Ö: PostgreSQL vs MongoDB
# 
# **–î–∏—Å—Ü–∏–ø–ª–∏–Ω–∞:** –ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è –∏ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –±–æ–ª—å—à–∏—Ö –¥–∞–Ω–Ω—ã—Ö  
# **–¢–µ–º–∞:** –°—Ä–∞–≤–Ω–µ–Ω–∏–µ –ø–æ–¥—Ö–æ–¥–æ–≤ —Ö—Ä–∞–Ω–µ–Ω–∏—è –±–æ–ª—å—à–∏—Ö –¥–∞–Ω–Ω—ã—Ö  
# **–í–∞—Ä–∏–∞–Ω—Ç:** 3  
# 
# **–í—ã–ø–æ–ª–Ω–∏–ª–∞:** –ê—Ä–ª–∏–Ω—Å–∫–∞—è –ê–ª–µ–∫—Å–∞–Ω–¥—Ä–∞ –í–∏–∫—Ç–æ—Ä–æ–≤–Ω–∞  
# **–ü—Ä–æ–≤–µ—Ä–∏–ª:** –ë–æ—Å–µ–Ω–∫–æ –¢–∏–º—É—Ä –ú—É—Ä—Ç–∞–∑–æ–≤–∏—á  
# **–ö—É—Ä—Å –æ–±—É—á–µ–Ω–∏—è:** 4  
# **–§–æ—Ä–º–∞ –æ–±—É—á–µ–Ω–∏—è:** –æ—á–Ω–∞—è  
# 
# **–ò–Ω—Å—Ç–∏—Ç—É—Ç —Ü–∏—Ñ—Ä–æ–≤–æ–≥–æ –æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏—è**  
# **–î–µ–ø–∞—Ä—Ç–∞–º–µ–Ω—Ç –∏–Ω—Ñ–æ—Ä–º–∞—Ç–∏–∫–∏, —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∏ —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–π**  
# **–ú–æ—Å–∫–æ–≤—Å–∫–∏–π –≥–æ—Ä–æ–¥—Å–∫–æ–π –ø–µ–¥–∞–≥–æ–≥–∏—á–µ—Å–∫–∏–π —É–Ω–∏–≤–µ—Ä—Å–∏—Ç–µ—Ç**  
# **–ú–æ—Å–∫–≤–∞ 2025**

# %% [markdown]
# ## –¶–µ–ª—å —Ä–∞–±–æ—Ç—ã
# –°—Ä–∞–≤–Ω–∏—Ç—å –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –∏ —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç—å —Ä–∞–∑–ª–∏—á–Ω—ã—Ö –ø–æ–¥—Ö–æ–¥–æ–≤ –∫ —Ö—Ä–∞–Ω–µ–Ω–∏—é –∏ –æ–±—Ä–∞–±–æ—Ç–∫–µ –±–æ–ª—å—à–∏—Ö –¥–∞–Ω–Ω—ã—Ö –Ω–∞ –ø—Ä–∏–º–µ—Ä–µ —Ä–µ–ª—è—Ü–∏–æ–Ω–Ω–æ–π –°–£–ë–î PostgreSQL –∏ –¥–æ–∫—É–º–µ–Ω—Ç–æ-–æ—Ä–∏–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω–æ–π –°–£–ë–î MongoDB.

# %% [markdown]
# ## –¢–µ–æ—Ä–µ—Ç–∏—á–µ—Å–∫–∞—è —á–∞—Å—Ç—å

# %% [markdown]
# ### PostgreSQL
# **PostgreSQL** - —ç—Ç–æ —Ä–µ–ª—è—Ü–∏–æ–Ω–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –±–∞–∑–∞–º–∏ –¥–∞–Ω–Ω—ã—Ö —Å –æ—Ç–∫—Ä—ã—Ç—ã–º –∏—Å—Ö–æ–¥–Ω—ã–º –∫–æ–¥–æ–º, –∫–æ—Ç–æ—Ä–∞—è –∏—Å–ø–æ–ª—å–∑—É–µ—Ç SQL –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –¥–∞–Ω–Ω—ã—Ö. –û—Å–Ω–æ–≤–Ω—ã–µ —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏:
# - –°—Ç—Ä–æ–≥–∞—è —Å—Ö–µ–º–∞ –¥–∞–Ω–Ω—ã—Ö —Å –ø—Ä–µ–¥–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω–æ–π —Å—Ç—Ä—É–∫—Ç—É—Ä–æ–π
# - –ü–æ–¥–¥–µ—Ä–∂–∫–∞ ACID (–∞—Ç–æ–º–∞—Ä–Ω–æ—Å—Ç—å, —Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–Ω–æ—Å—Ç—å, –∏–∑–æ–ª–∏—Ä–æ–≤–∞–Ω–Ω–æ—Å—Ç—å, –¥–æ–ª–≥–æ–≤–µ—á–Ω–æ—Å—Ç—å)
# - –°–ª–æ–∂–Ω—ã–µ JOIN-–æ–ø–µ—Ä–∞—Ü–∏–∏ –º–µ–∂–¥—É —Ç–∞–±–ª–∏—Ü–∞–º–∏
# - –¢—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –∏ —Ü–µ–ª–æ—Å—Ç–Ω–æ—Å—Ç—å –¥–∞–Ω–Ω—ã—Ö
# - –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –≤–Ω–µ—à–Ω–∏—Ö –∫–ª—é—á–µ–π –∏ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–π

# %% [markdown]
# ### MongoDB
# **MongoDB** - —ç—Ç–æ –¥–æ–∫—É–º–µ–Ω—Ç–æ-–æ—Ä–∏–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω–∞—è NoSQL –±–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö, –∫–æ—Ç–æ—Ä–∞—è —Ö—Ä–∞–Ω–∏—Ç –¥–∞–Ω–Ω—ã–µ –≤ –≤–∏–¥–µ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤ BSON (–±–∏–Ω–∞—Ä–Ω—ã–π JSON). –û—Å–Ω–æ–≤–Ω—ã–µ —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏:
# - –ì–∏–±–∫–∞—è —Å—Ö–µ–º–∞ –¥–∞–Ω–Ω—ã—Ö
# - –ì–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω–∞—è –º–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–æ—Å—Ç—å
# - –î–æ–∫—É–º–µ–Ω—Ç–Ω–∞—è –º–æ–¥–µ–ª—å —Å –≤–ª–æ–∂–µ–Ω–Ω—ã–º–∏ —Å—Ç—Ä—É–∫—Ç—É—Ä–∞–º–∏
# - –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ JOIN-–æ–ø–µ—Ä–∞—Ü–∏–π (–≤–º–µ—Å—Ç–æ –Ω–∏—Ö - –∞–≥—Ä–µ–≥–∞—Ü–∏–æ–Ω–Ω—ã–µ –ø–∞–π–ø–ª–∞–π–Ω—ã)
# - –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–∞ –¥–ª—è –æ–ø–µ—Ä–∞—Ü–∏–π —á—Ç–µ–Ω–∏—è –∏ –∑–∞–ø–∏—Å–∏ –±–æ–ª—å—à–∏—Ö –æ–±—ä–µ–º–æ–≤ –¥–∞–Ω–Ω—ã—Ö

# %% [markdown]
# ### –ö–ª—é—á–µ–≤—ã–µ —Ä–∞–∑–ª–∏—á–∏—è
# 
# | –•–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∞ | PostgreSQL | MongoDB |
# |----------------|------------|---------|
# | **–ú–æ–¥–µ–ª—å –¥–∞–Ω–Ω—ã—Ö** | –†–µ–ª—è—Ü–∏–æ–Ω–Ω–∞—è | –î–æ–∫—É–º–µ–Ω—Ç–Ω–∞—è |
# | **–°—Ö–µ–º–∞** | –°—Ç—Ä–æ–≥–∞—è, —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω–∞—è | –ì–∏–±–∫–∞—è, –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∞—è |
# | **–ú–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ** | –í–µ—Ä—Ç–∏–∫–∞–ª—å–Ω–æ–µ | –ì–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω–æ–µ |
# | **–Ø–∑—ã–∫ –∑–∞–ø—Ä–æ—Å–æ–≤** | SQL | MongoDB Query Language |
# | **–¢—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏** | –ü–æ–ª–Ω–∞—è –ø–æ–¥–¥–µ—Ä–∂–∫–∞ ACID | –û–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω–∞—è –ø–æ–¥–¥–µ—Ä–∂–∫–∞ |
# | **JOIN –æ–ø–µ—Ä–∞—Ü–∏–∏** | –≠—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω—ã–µ JOIN | –ù–µ—Ç JOIN, –¥–µ–Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è |

# %% [markdown]
# ## –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ —Ä–µ—à–µ–Ω–∏—è –∏ –ø–æ—Ç–æ–∫–∏ –¥–∞–Ω–Ω—ã—Ö

# %% [markdown]
# ### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–∞–Ω–Ω—ã—Ö –≤ PostgreSQL
# 
# –í PostgreSQL –¥–∞–Ω–Ω—ã–µ –æ—Ä–≥–∞–Ω–∏–∑–æ–≤–∞–Ω—ã –≤ –Ω–æ—Ä–º–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—É—é —Ä–µ–ª—è—Ü–∏–æ–Ω–Ω—É—é —Å—Ç—Ä—É–∫—Ç—É—Ä—É:
# - **warehouses** - —Ç–∞–±–ª–∏—Ü–∞ —Å–∫–ª–∞–¥–æ–≤
# - **routes** - —Ç–∞–±–ª–∏—Ü–∞ –º–∞—Ä—à—Ä—É—Ç–æ–≤  
# - **shipments** - —Ç–∞–±–ª–∏—Ü–∞ –≥—Ä—É–∑–æ–≤ —Å –≤–Ω–µ—à–Ω–∏–º–∏ –∫–ª—é—á–∞–º–∏
# 
# –°–≤—è–∑–∏ –º–µ–∂–¥—É —Ç–∞–±–ª–∏—Ü–∞–º–∏:
# - shipments.warehouse_from_id ‚Üí warehouses.id
# - shipments.warehouse_to_id ‚Üí warehouses.id
# - shipments.route_id ‚Üí routes.id

# %% [markdown]
# ### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–∞–Ω–Ω—ã—Ö –≤ MongoDB
# 
# –í MongoDB –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–æ–∫—É–º–µ–Ω—Ç–Ω–∞—è –º–æ–¥–µ–ª—å —Å –≤–ª–æ–∂–µ–Ω–Ω—ã–º–∏ –æ–±—ä–µ–∫—Ç–∞–º–∏:
# - –ö–æ–ª–ª–µ–∫—Ü–∏—è **shipments** —Å–æ–¥–µ—Ä–∂–∏—Ç –¥–æ–∫—É–º–µ–Ω—Ç—ã —Å –ø–æ–ª–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π
# - –í–ª–æ–∂–µ–Ω–Ω—ã–µ –æ–±—ä–µ–∫—Ç—ã: warehouse_from, warehouse_to, route
# - –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏–∏, –≤—Å–µ –¥–∞–Ω–Ω—ã–µ –≤ –æ–¥–Ω–æ–º –¥–æ–∫—É–º–µ–Ω—Ç–µ

# %% [markdown]
# ### –î–∏–∞–≥—Ä–∞–º–º–∞ –ø–æ—Ç–æ–∫–æ–≤ –¥–∞–Ω–Ω—ã—Ö
# 
# ```
# –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö (Python)
#         ‚Üì
#     JSON —Ñ–∞–π–ª
#         ‚Üì
#     ‚Üó       ‚Üò
# PostgreSQL   MongoDB
#     ‚Üì           ‚Üì
# –¢–∞–±–ª–∏—Ü—ã:      –ö–æ–ª–ª–µ–∫—Ü–∏—è:
# - warehouses  - shipments
# - routes      (—Å –≤–ª–æ–∂–µ–Ω–Ω—ã–º–∏
# - shipments     –¥–æ–∫—É–º–µ–Ω—Ç–∞–º–∏)
#     ‚Üì           ‚Üì
# –í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ    –í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ
# SQL –∑–∞–ø—Ä–æ—Å–æ–≤  MQL –∑–∞–ø—Ä–æ—Å–æ–≤
#     ‚Üì           ‚Üì
# –°—Ä–∞–≤–Ω–µ–Ω–∏–µ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
#         ‚Üì
#     –ê–Ω–∞–ª–∏–∑ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
# ```

# %% [markdown]
# ## –ü—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∞—è —á–∞—Å—Ç—å

# %% [markdown]
# ### –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∏ –∏–º–ø–æ—Ä—Ç –±–∏–±–ª–∏–æ—Ç–µ–∫

# %%
import pandas as pd
import numpy as np
import json
import time
import matplotlib.pyplot as plt
import seaborn as sns
from datetime import datetime, timedelta
import psycopg2
from pymongo import MongoClient
import warnings
warnings.filterwarnings('ignore')

print("–ë–∏–±–ª–∏–æ—Ç–µ–∫–∏ —É—Å–ø–µ—à–Ω–æ –∏–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω—ã")

# %% [markdown]
# ### –ó–∞–¥–∞–Ω–∏–µ 1: –ì–µ–Ω–µ—Ä–∞—Ü–∏—è —Ç–µ—Å—Ç–æ–≤—ã—Ö –¥–∞–Ω–Ω—ã—Ö

# %%
def generate_logistics_data():
    """–ì–µ–Ω–µ—Ä–∞—Ü–∏—è —Ç–µ—Å—Ç–æ–≤—ã—Ö –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –ª–æ–≥–∏—Å—Ç–∏—á–µ—Å–∫–æ–π —Å–∏—Å—Ç–µ–º—ã"""
    np.random.seed(42)
    
    # –ü–∞—Ä–∞–º–µ—Ç—Ä—ã –¥–∞–Ω–Ω—ã—Ö
    n_shipments = 100000
    n_warehouses = 100
    n_routes = 500
    
    print("üìä –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –ª–æ–≥–∏—Å—Ç–∏—á–µ—Å–∫–∏—Ö –¥–∞–Ω–Ω—ã—Ö...")
    
    # –ì–µ–Ω–µ—Ä–∞—Ü–∏—è —Å–∫–ª–∞–¥–æ–≤
    cities = ['–ú–æ—Å–∫–≤–∞', '–°–∞–Ω–∫—Ç-–ü–µ—Ç–µ—Ä–±—É—Ä–≥', '–ù–æ–≤–æ—Å–∏–±–∏—Ä—Å–∫', '–ï–∫–∞—Ç–µ—Ä–∏–Ω–±—É—Ä–≥', '–ö–∞–∑–∞–Ω—å']
    warehouse_types = ['–¶–µ–Ω—Ç—Ä–∞–ª—å–Ω—ã–π', '–†–µ–≥–∏–æ–Ω–∞–ª—å–Ω—ã–π', '–õ–æ–∫–∞–ª—å–Ω—ã–π', '–¢—Ä–∞–Ω–∑–∏—Ç–Ω—ã–π']
    
    warehouses_data = []
    for i in range(n_warehouses):
        warehouses_data.append({
            'id': i,
            'name': f"–°–∫–ª–∞–¥_{i:03d}",
            'city': np.random.choice(cities),
            'type': np.random.choice(warehouse_types),
            'capacity': np.random.randint(1000, 50000),
            'employees': np.random.randint(5, 200),
            'latitude': round(np.random.uniform(55.0, 58.0), 6),
            'longitude': round(np.random.uniform(37.0, 40.0), 6)
        })
    
    # –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –º–∞—Ä—à—Ä—É—Ç–æ–≤
    transport_types = ['–ì—Ä—É–∑–æ–≤–∏–∫', '–§—É—Ä–∞', '–†–µ—Ñ—Ä–∏–∂–µ—Ä–∞—Ç–æ—Ä', '–ö–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤–æ–∑']
    
    routes_data = []
    for i in range(n_routes):
        start_city = np.random.choice(cities)
        end_city = np.random.choice([c for c in cities if c != start_city])
        distance = np.random.randint(100, 2000)
        
        routes_data.append({
            'id': i,
            'name': f"–ú–∞—Ä—à—Ä—É—Ç_{i:03d}: {start_city}-{end_city}",
            'start_city': start_city,
            'end_city': end_city,
            'distance': distance,
            'duration_hours': distance // 60,
            'transport_type': np.random.choice(transport_types),
            'status': np.random.choice(['–ê–∫—Ç–∏–≤–µ–Ω', '–ù–µ–∞–∫—Ç–∏–≤–µ–Ω'], p=[0.8, 0.2]),
            'cost_per_km': round(np.random.uniform(10, 50), 2)
        })
    
    # –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –≥—Ä—É–∑–æ–≤
    start_date = datetime(2023, 1, 1)
    shipment_statuses = ['–í –æ–±—Ä–∞–±–æ—Ç–∫–µ', '–í –ø—É—Ç–∏', '–î–æ—Å—Ç–∞–≤–ª–µ–Ω', '–ó–∞–¥–µ—Ä–∂–∞–Ω']
    
    shipments_data = []
    for i in range(n_shipments):
        warehouse_from = np.random.randint(0, n_warehouses)
        warehouse_to = np.random.randint(0, n_warehouses)
        
        while warehouse_to == warehouse_from:
            warehouse_to = np.random.randint(0, n_warehouses)
        
        shipments_data.append({
            'id': i,
            'tracking_number': f"TRK{i:08d}",
            'warehouse_from_id': warehouse_from,
            'warehouse_to_id': warehouse_to,
            'route_id': np.random.randint(0, n_routes),
            'weight': round(np.random.uniform(1, 1000), 2),
            'volume': round(np.random.uniform(0.1, 10), 2),
            'value': round(np.random.uniform(100, 50000), 2),
            'shipment_date': (start_date + timedelta(days=np.random.randint(0, 365))).isoformat(),
            'delivery_date': (start_date + timedelta(days=np.random.randint(1, 380))).isoformat(),
            'status': np.random.choice(shipment_statuses, p=[0.2, 0.3, 0.4, 0.1]),
            'type': np.random.choice(['–•—Ä—É–ø–∫–∏–π', '–û–ø–∞—Å–Ω—ã–π', '–°–∫–æ—Ä–æ–ø–æ—Ä—Ç—è—â–∏–π—Å—è', '–û–±—ã—á–Ω—ã–π']),
            'priority': np.random.choice(['–ù–∏–∑–∫–∏–π', '–°—Ä–µ–¥–Ω–∏–π', '–í—ã—Å–æ–∫–∏–π'], p=[0.6, 0.3, 0.1])
        })
    
    # –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ JSON
    data = {
        'metadata': {
            'generated_at': datetime.now().isoformat(),
            'n_shipments': n_shipments,
            'n_warehouses': n_warehouses,
            'n_routes': n_routes
        },
        'warehouses': warehouses_data,
        'routes': routes_data,
        'shipments': shipments_data
    }
    
    import os
    os.makedirs('data', exist_ok=True)
    with open('data/01_generated_data.json', 'w', encoding='utf-8') as f:
        json.dump(data, f, ensure_ascii=False, indent=2)
    
    print("‚úÖ –î–∞–Ω–Ω—ã–µ —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω—ã –∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã –≤ data/01_generated_data.json")
    
    # –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
    print(f"üì¶ –°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–æ:")
    print(f"   - –°–∫–ª–∞–¥—ã: {len(warehouses_data):,}")
    print(f"   - –ú–∞—Ä—à—Ä—É—Ç—ã: {len(routes_data):,}")
    print(f"   - –ì—Ä—É–∑—ã: {len(shipments_data):,}")
    
    return data

# –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö
logistics_data = generate_logistics_data()

# %% [markdown]
# ### –ó–∞–¥–∞–Ω–∏–µ 2: –ù–∞—Å—Ç—Ä–æ–π–∫–∞ PostgreSQL

# %%
def setup_postgres_database():
    """–ù–∞—Å—Ç—Ä–æ–π–∫–∞ PostgreSQL –∏ –∑–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö"""
    
    print("üóÑÔ∏è –ù–ê–°–¢–†–û–ô–ö–ê POSTGRESQL")
    print("=" * 40)
    
    try:
        # –ü–∞—Ä–∞–º–µ—Ç—Ä—ã –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è
        conn_params = {
            "dbname": "studpg",
            "user": "student", 
            "password": "Stud2024!!!",
            "host": "localhost",
            "port": "5432"
        }
        
        # –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ PostgreSQL
        print("üîó –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ PostgreSQL...")
        conn = psycopg2.connect(**conn_params)
        cur = conn.cursor()
        print("‚úÖ –£—Å–ø–µ—à–Ω–æ–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ PostgreSQL")
        
        # –ó–∞–≥—Ä—É–∑–∫–∞ —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
        with open('data/01_generated_data.json', 'r', encoding='utf-8') as f:
            data = json.load(f)
        
        # –°–æ–∑–¥–∞–Ω–∏–µ —Ç–∞–±–ª–∏—Ü
        print("üìù –°–æ–∑–¥–∞–Ω–∏–µ —Ç–∞–±–ª–∏—Ü...")
        
        # –¢–∞–±–ª–∏—Ü–∞ warehouses
        cur.execute("""
            CREATE TABLE IF NOT EXISTS warehouses (
                id INTEGER PRIMARY KEY,
                name VARCHAR(100),
                city VARCHAR(50),
                type VARCHAR(50),
                capacity INTEGER,
                employees INTEGER,
                latitude DECIMAL(10,6),
                longitude DECIMAL(10,6)
            )
        """)
        
        # –¢–∞–±–ª–∏—Ü–∞ routes
        cur.execute("""
            CREATE TABLE IF NOT EXISTS routes (
                id INTEGER PRIMARY KEY,
                name VARCHAR(100),
                start_city VARCHAR(50),
                end_city VARCHAR(50),
                distance INTEGER,
                duration_hours INTEGER,
                transport_type VARCHAR(50),
                status VARCHAR(50),
                cost_per_km DECIMAL(10,2)
            )
        """)
        
        # –¢–∞–±–ª–∏—Ü–∞ shipments
        cur.execute("""
            CREATE TABLE IF NOT EXISTS shipments (
                id INTEGER PRIMARY KEY,
                tracking_number VARCHAR(20),
                warehouse_from_id INTEGER,
                warehouse_to_id INTEGER,
                route_id INTEGER,
                weight DECIMAL(10,2),
                volume DECIMAL(10,2),
                value DECIMAL(10,2),
                shipment_date TIMESTAMP,
                delivery_date TIMESTAMP,
                status VARCHAR(50),
                type VARCHAR(50),
                priority VARCHAR(20)
            )
        """)
        print("‚úÖ –¢–∞–±–ª–∏—Ü—ã —Å–æ–∑–¥–∞–Ω—ã")
        
        # –ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö
        print("üì• –ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö...")
        
        # –ó–∞–≥—Ä—É–∑–∫–∞ —Å–∫–ª–∞–¥–æ–≤
        warehouses_count = 0
        for warehouse in data['warehouses']:
            cur.execute("""
                INSERT INTO warehouses (id, name, city, type, capacity, employees, latitude, longitude)
                VALUES (%s, %s, %s, %s, %s, %s, %s, %s)
            """, (warehouse['id'], warehouse['name'], warehouse['city'], 
                  warehouse['type'], warehouse['capacity'], warehouse['employees'],
                  warehouse['latitude'], warehouse['longitude']))
            warehouses_count += 1
        
        # –ó–∞–≥—Ä—É–∑–∫–∞ –º–∞—Ä—à—Ä—É—Ç–æ–≤
        routes_count = 0
        for route in data['routes']:
            cur.execute("""
                INSERT INTO routes (id, name, start_city, end_city, distance, duration_hours, 
                                 transport_type, status, cost_per_km)
                VALUES (%s, %s, %s, %s, %s, %s, %s, %s, %s)
            """, (route['id'], route['name'], route['start_city'], route['end_city'],
                  route['distance'], route['duration_hours'], route['transport_type'],
                  route['status'], route['cost_per_km']))
            routes_count += 1
        
        # –ó–∞–≥—Ä—É–∑–∫–∞ –≥—Ä—É–∑–æ–≤
        shipments_count = 0
        for shipment in data['shipments']:
            cur.execute("""
                INSERT INTO shipments (id, tracking_number, warehouse_from_id, warehouse_to_id, 
                                    route_id, weight, volume, value, shipment_date, 
                                    delivery_date, status, type, priority)
                VALUES (%s, %s, %s, %s, %s, %s, %s, %s, %s, %s, %s, %s, %s)
            """, (shipment['id'], shipment['tracking_number'], shipment['warehouse_from_id'],
                  shipment['warehouse_to_id'], shipment['route_id'], shipment['weight'],
                  shipment['volume'], shipment['value'], shipment['shipment_date'],
                  shipment['delivery_date'], shipment['status'], shipment['type'],
                  shipment['priority']))
            shipments_count += 1
        
        conn.commit()
        print(f"‚úÖ –î–∞–Ω–Ω—ã–µ –∑–∞–≥—Ä—É–∂–µ–Ω—ã: —Å–∫–ª–∞–¥—ã={warehouses_count}, –º–∞—Ä—à—Ä—É—Ç—ã={routes_count}, –≥—Ä—É–∑—ã={shipments_count}")
        
        # –°–æ–∑–¥–∞–Ω–∏–µ –∏–Ω–¥–µ–∫—Å–æ–≤
        print("üîç –°–æ–∑–¥–∞–Ω–∏–µ –∏–Ω–¥–µ–∫—Å–æ–≤...")
        cur.execute("CREATE INDEX IF NOT EXISTS idx_shipments_weight ON shipments(weight)")
        cur.execute("CREATE INDEX IF NOT EXISTS idx_shipments_status ON shipments(status)")
        cur.execute("CREATE INDEX IF NOT EXISTS idx_shipments_tracking ON shipments(tracking_number)")
        conn.commit()
        print("‚úÖ –ò–Ω–¥–µ–∫—Å—ã —Å–æ–∑–¥–∞–Ω—ã")
        
        # –ü–æ–ª—É—á–µ–Ω–∏–µ —Ä–∞–∑–º–µ—Ä–∞ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
        cur.execute("SELECT pg_size_pretty(pg_database_size('studpg'))")
        db_size = cur.fetchone()[0]
        print(f"üíæ –†–∞–∑–º–µ—Ä –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö: {db_size}")
        
        # –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —Ç–∞–±–ª–∏—Ü
        cur.execute("SELECT COUNT(*) FROM warehouses")
        warehouses_count = cur.fetchone()[0]
        
        cur.execute("SELECT COUNT(*) FROM routes")
        routes_count = cur.fetchone()[0]
        
        cur.execute("SELECT COUNT(*) FROM shipments")
        shipments_count = cur.fetchone()[0]
        
        print(f"üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —Ç–∞–±–ª–∏—Ü:")
        print(f"   - warehouses: {warehouses_count} –∑–∞–ø–∏—Å–µ–π")
        print(f"   - routes: {routes_count} –∑–∞–ø–∏—Å–µ–π")
        print(f"   - shipments: {shipments_count} –∑–∞–ø–∏—Å–µ–π")
        
        conn.close()
        
        return {
            'status': 'success',
            'database_size': db_size,
            'records_loaded': {
                'warehouses': warehouses_count,
                'routes': routes_count,
                'shipments': shipments_count
            }
        }
        
    except Exception as e:
        print(f"‚ùå –û—à–∏–±–∫–∞: {e}")
        return {'status': 'error', 'message': str(e)}

# –ó–∞–ø—É—Å–∫ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ PostgreSQL
postgres_result = setup_postgres_database()

# %% [markdown]
# ### –ó–∞–¥–∞–Ω–∏–µ 3: –ù–∞—Å—Ç—Ä–æ–π–∫–∞ MongoDB

# %%
def setup_mongodb_database():
    """–ù–∞—Å—Ç—Ä–æ–π–∫–∞ MongoDB –∏ –∑–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö"""
    
    print("\nüçÉ –ù–ê–°–¢–†–û–ô–ö–ê MONGODB")
    print("=" * 40)
    
    try:
        # –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ MongoDB
        print("üîó –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ MongoDB...")
        client = MongoClient('mongodb://localhost:27017/')
        db = client['studmongo']
        print("‚úÖ –£—Å–ø–µ—à–Ω–æ–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ MongoDB")
        
        # –û—á–∏—Å—Ç–∫–∞ –∫–æ–ª–ª–µ–∫—Ü–∏–π
        print("üóëÔ∏è –û—á–∏—Å—Ç–∫–∞ —Å—Ç–∞—Ä—ã—Ö –∫–æ–ª–ª–µ–∫—Ü–∏–π...")
        db.shipments.drop()
        
        # –ó–∞–≥—Ä—É–∑–∫–∞ —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
        with open('data/01_generated_data.json', 'r', encoding='utf-8') as f:
            data = json.load(f)
        
        # –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –¥–∞–Ω–Ω—ã—Ö –¥–ª—è MongoDB —Å –≤–ª–æ–∂–µ–Ω–Ω—ã–º–∏ –¥–æ–∫—É–º–µ–Ω—Ç–∞–º–∏
        print("üì• –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –¥–∞–Ω–Ω—ã—Ö –¥–ª—è MongoDB...")
        
        # –°–æ–∑–¥–∞–µ–º —Å–ª–æ–≤–∞—Ä–∏ –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ –¥–æ—Å—Ç—É–ø–∞
        warehouses_dict = {w['id']: w for w in data['warehouses']}
        routes_dict = {r['id']: r for r in data['routes']}
        
        # –°–æ–∑–¥–∞–µ–º –¥–æ–∫—É–º–µ–Ω—Ç—ã –≥—Ä—É–∑–æ–≤ —Å –≤–ª–æ–∂–µ–Ω–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π
        shipments_docs = []
        for shipment in data['shipments']:
            warehouse_from = warehouses_dict[shipment['warehouse_from_id']]
            warehouse_to = warehouses_dict[shipment['warehouse_to_id']]
            route = routes_dict[shipment['route_id']]
            
            shipment_doc = {
                '_id': shipment['id'],
                'tracking_number': shipment['tracking_number'],
                'warehouse_from': {
                    'id': warehouse_from['id'],
                    'name': warehouse_from['name'],
                    'city': warehouse_from['city'],
                    'type': warehouse_from['type'],
                    'capacity': warehouse_from['capacity'],
                    'employees': warehouse_from['employees'],
                    'latitude': warehouse_from['latitude'],
                    'longitude': warehouse_from['longitude']
                },
                'warehouse_to': {
                    'id': warehouse_to['id'],
                    'name': warehouse_to['name'],
                    'city': warehouse_to['city'],
                    'type': warehouse_to['type'],
                    'capacity': warehouse_to['capacity'],
                    'employees': warehouse_to['employees'],
                    'latitude': warehouse_to['latitude'],
                    'longitude': warehouse_to['longitude']
                },
                'route': {
                    'id': route['id'],
                    'name': route['name'],
                    'start_city': route['start_city'],
                    'end_city': route['end_city'],
                    'distance': route['distance'],
                    'duration_hours': route['duration_hours'],
                    'transport_type': route['transport_type'],
                    'status': route['status'],
                    'cost_per_km': route['cost_per_km']
                },
                'weight': shipment['weight'],
                'volume': shipment['volume'],
                'value': shipment['value'],
                'shipment_date': shipment['shipment_date'],
                'delivery_date': shipment['delivery_date'],
                'status': shipment['status'],
                'type': shipment['type'],
                'priority': shipment['priority']
            }
            shipments_docs.append(shipment_doc)
        
        # –ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö –≤ MongoDB
        print("üì• –ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö –≤ MongoDB...")
        result = db.shipments.insert_many(shipments_docs)
        print(f"‚úÖ –ó–∞–≥—Ä—É–∂–µ–Ω–æ {len(result.inserted_ids)} –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤ –≤ MongoDB")
        
        # –°–æ–∑–¥–∞–Ω–∏–µ –∏–Ω–¥–µ–∫—Å–æ–≤
        print("üîç –°–æ–∑–¥–∞–Ω–∏–µ –∏–Ω–¥–µ–∫—Å–æ–≤...")
        db.shipments.create_index("weight")
        db.shipments.create_index("status")
        db.shipments.create_index("tracking_number")
        db.shipments.create_index("warehouse_from.city")
        db.shipments.create_index("warehouse_to.city")
        print("‚úÖ –ò–Ω–¥–µ–∫—Å—ã —Å–æ–∑–¥–∞–Ω—ã")
        
        # –ü–æ–ª—É—á–µ–Ω–∏–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ –∫–æ–ª–ª–µ–∫—Ü–∏–∏
        stats = db.command("collstats", "shipments")
        collection_size_mb = stats['size'] / (1024 * 1024)
        storage_size_mb = stats['storageSize'] / (1024 * 1024)
        count = db.shipments.count_documents({})
        
        print(f"üíæ –†–∞–∑–º–µ—Ä –∫–æ–ª–ª–µ–∫—Ü–∏–∏: {collection_size_mb:.2f} MB")
        print(f"üíæ –†–∞–∑–º–µ—Ä —Ö—Ä–∞–Ω–∏–ª–∏—â–∞: {storage_size_mb:.2f} MB")
        print(f"üìä –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤: {count:,}")
        
        client.close()
        
        return {
            'status': 'success',
            'collection_size_mb': round(collection_size_mb, 2),
            'storage_size_mb': round(storage_size_mb, 2),
            'documents_count': count
        }
        
    except Exception as e:
        print(f"‚ùå –û—à–∏–±–∫–∞: {e}")
        return {'status': 'error', 'message': str(e)}

# –ó–∞–ø—É—Å–∫ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ MongoDB
mongodb_result = setup_mongodb_database()

# %% [markdown]
# ### –ó–∞–¥–∞–Ω–∏–µ 4: –°—Ä–∞–≤–Ω–µ–Ω–∏–µ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏

# %%
def compare_performance():
    """–°—Ä–∞–≤–Ω–µ–Ω–∏–µ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ PostgreSQL –∏ MongoDB"""
    
    print("\n‚ö° –°–†–ê–í–ù–ï–ù–ò–ï –ü–†–û–ò–ó–í–û–î–ò–¢–ï–õ–¨–ù–û–°–¢–ò")
    print("=" * 50)
    
    results = {
        'postgresql': {},
        'mongodb': {},
        'comparison': {}
    }
    
    # –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ PostgreSQL
    print("\nüìä PostgreSQL - –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –∑–∞–ø—Ä–æ—Å–æ–≤...")
    
    try:
        conn = psycopg2.connect(
            dbname="studpg",
            user="student", 
            password="Stud2024!!!",
            host="localhost",
            port="5432"
        )
        cur = conn.cursor()
        
        # –ó–∞–ø—Ä–æ—Å 1: –ü—Ä–æ—Å—Ç–æ–π –ø–æ–∏—Å–∫ –ø–æ –≤–µ—Å—É (> 100 –∫–≥)
        start_time = time.time()
        cur.execute("SELECT COUNT(*) FROM shipments WHERE weight > 100")
        pg_count_heavy = cur.fetchone()[0]
        pg_time_simple = time.time() - start_time
        print(f"  ‚úÖ –ü—Ä–æ—Å—Ç–æ–π –ø–æ–∏—Å–∫ (>100–∫–≥): {pg_count_heavy} –∑–∞–ø–∏—Å–µ–π, {pg_time_simple:.4f}—Å")
        
        # –ó–∞–ø—Ä–æ—Å 2: –ü–æ–∏—Å–∫ —Å JOIN
        start_time = time.time()
        cur.execute("""
            SELECT s.tracking_number, wf.city, wt.city, r.distance
            FROM shipments s
            JOIN warehouses wf ON s.warehouse_from_id = wf.id
            JOIN warehouses wt ON s.warehouse_to_id = wt.id  
            JOIN routes r ON s.route_id = r.id
            WHERE s.weight > 500
            LIMIT 1000
        """)
        pg_join_results = cur.fetchall()
        pg_time_join = time.time() - start_time
        print(f"  ‚úÖ –ü–æ–∏—Å–∫ —Å JOIN: {len(pg_join_results)} –∑–∞–ø–∏—Å–µ–π, {pg_time_join:.4f}—Å")
        
        # –ó–∞–ø—Ä–æ—Å 3: –ê–≥—Ä–µ–≥–∞—Ü–∏—è
        start_time = time.time()
        cur.execute("""
            SELECT status, COUNT(*), AVG(weight), AVG(value)
            FROM shipments 
            GROUP BY status
        """)
        pg_agg_results = cur.fetchall()
        pg_time_agg = time.time() - start_time
        print(f"  ‚úÖ –ê–≥—Ä–µ–≥–∞—Ü–∏—è: {len(pg_agg_results)} –≥—Ä—É–ø–ø, {pg_time_agg:.4f}—Å")
        
        conn.close()
        
        results['postgresql'] = {
            'simple_search': pg_time_simple,
            'join_search': pg_time_join,
            'aggregation': pg_time_agg,
            'heavy_count': pg_count_heavy
        }
        
    except Exception as e:
        print(f"  ‚ùå –û—à–∏–±–∫–∞ PostgreSQL: {e}")
    
    # –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ MongoDB
    print("\nüìä MongoDB - –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –∑–∞–ø—Ä–æ—Å–æ–≤...")
    
    try:
        client = MongoClient('mongodb://localhost:27017/')
        db = client['studmongo']
        
        # –ó–∞–ø—Ä–æ—Å 1: –ü—Ä–æ—Å—Ç–æ–π –ø–æ–∏—Å–∫ –ø–æ –≤–µ—Å—É (> 100 –∫–≥)
        start_time = time.time()
        mongo_count_heavy = db.shipments.count_documents({"weight": {"$gt": 100}})
        mongo_time_simple = time.time() - start_time
        print(f"  ‚úÖ –ü—Ä–æ—Å—Ç–æ–π –ø–æ–∏—Å–∫ (>100–∫–≥): {mongo_count_heavy} –∑–∞–ø–∏—Å–µ–π, {mongo_time_simple:.4f}—Å")
        
        # –ó–∞–ø—Ä–æ—Å 2: –ü–æ–∏—Å–∫ —Å –≤–ª–æ–∂–µ–Ω–Ω—ã–º–∏ –¥–æ–∫—É–º–µ–Ω—Ç–∞–º–∏
        start_time = time.time()
        mongo_join_results = list(db.shipments.find(
            {"weight": {"$gt": 500}},
            {
                "tracking_number": 1,
                "warehouse_from.city": 1,
                "warehouse_to.city": 1, 
                "route.distance": 1
            }
        ).limit(1000))
        mongo_time_join = time.time() - start_time
        print(f"  ‚úÖ –ü–æ–∏—Å–∫ —Å –≤–ª–æ–∂–µ–Ω–Ω—ã–º–∏ –¥–æ–∫—É–º–µ–Ω—Ç–∞–º–∏: {len(mongo_join_results)} –∑–∞–ø–∏—Å–µ–π, {mongo_time_join:.4f}—Å")
        
        # –ó–∞–ø—Ä–æ—Å 3: –ê–≥—Ä–µ–≥–∞—Ü–∏—è
        start_time = time.time()
        pipeline = [
            {"$group": {
                "_id": "$status",
                "count": {"$sum": 1},
                "avg_weight": {"$avg": "$weight"},
                "avg_value": {"$avg": "$value"}
            }}
        ]
        mongo_agg_results = list(db.shipments.aggregate(pipeline))
        mongo_time_agg = time.time() - start_time
        print(f"  ‚úÖ –ê–≥—Ä–µ–≥–∞—Ü–∏—è: {len(mongo_agg_results)} –≥—Ä—É–ø–ø, {mongo_time_agg:.4f}—Å")
        
        client.close()
        
        results['mongodb'] = {
            'simple_search': mongo_time_simple,
            'nested_search': mongo_time_join,
            'aggregation': mongo_time_agg,
            'heavy_count': mongo_count_heavy
        }
        
    except Exception as e:
        print(f"  ‚ùå –û—à–∏–±–∫–∞ MongoDB: {e}")
    
    # –°—Ä–∞–≤–Ω–µ–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
    if results['postgresql'] and results['mongodb']:
        print("\nüìà –°–†–ê–í–ù–ï–ù–ò–ï –†–ï–ó–£–õ–¨–¢–ê–¢–û–í:")
        print("=" * 40)
        
        # –°—Ä–∞–≤–Ω–µ–Ω–∏–µ –ø—Ä–æ—Å—Ç–æ–≥–æ –ø–æ–∏—Å–∫–∞
        pg_simple = results['postgresql']['simple_search']
        mongo_simple = results['mongodb']['simple_search']
        
        if pg_simple < mongo_simple:
            faster_simple = "PostgreSQL"
            speedup_simple = mongo_simple / pg_simple
        else:
            faster_simple = "MongoDB"
            speedup_simple = pg_simple / mongo_simple
            
        print(f"üîç –ü—Ä–æ—Å—Ç–æ–π –ø–æ–∏—Å–∫ (>100–∫–≥):")
        print(f"   PostgreSQL: {pg_simple:.4f}—Å, MongoDB: {mongo_simple:.4f}—Å")
        print(f"   –ë—ã—Å—Ç—Ä–µ–µ: {faster_simple} (–≤ {speedup_simple:.2f} —Ä–∞–∑)")
        
        # –°—Ä–∞–≤–Ω–µ–Ω–∏–µ —Å–ª–æ–∂–Ω–æ–≥–æ –ø–æ–∏—Å–∫–∞
        pg_join = results['postgresql']['join_search']
        mongo_join = results['mongodb']['nested_search']
        
        if pg_join < mongo_join:
            faster_join = "PostgreSQL"
            speedup_join = mongo_join / pg_join
        else:
            faster_join = "MongoDB"
            speedup_join = pg_join / mongo_join
            
        print(f"üîó –°–ª–æ–∂–Ω—ã–π –ø–æ–∏—Å–∫:")
        print(f"   PostgreSQL: {pg_join:.4f}—Å, MongoDB: {mongo_join:.4f}—Å")
        print(f"   –ë—ã—Å—Ç—Ä–µ–µ: {faster_join} (–≤ {speedup_join:.2f} —Ä–∞–∑)")
        
        # –°—Ä–∞–≤–Ω–µ–Ω–∏–µ –∞–≥—Ä–µ–≥–∞—Ü–∏–∏
        pg_agg = results['postgresql']['aggregation']
        mongo_agg = results['mongodb']['aggregation']
        
        if pg_agg < mongo_agg:
            faster_agg = "PostgreSQL"
            speedup_agg = mongo_agg / pg_agg
        else:
            faster_agg = "MongoDB"
            speedup_agg = pg_agg / mongo_agg
            
        print(f"üìä –ê–≥—Ä–µ–≥–∞—Ü–∏—è:")
        print(f"   PostgreSQL: {pg_agg:.4f}—Å, MongoDB: {mongo_agg:.4f}—Å")
        print(f"   –ë—ã—Å—Ç—Ä–µ–µ: {faster_agg} (–≤ {speedup_agg:.2f} —Ä–∞–∑)")
        
        results['comparison'] = {
            'simple_search': {'faster': faster_simple, 'speedup': speedup_simple},
            'join_search': {'faster': faster_join, 'speedup': speedup_join},
            'aggregation': {'faster': faster_agg, 'speedup': speedup_agg}
        }
    
    return results

# –ó–∞–ø—É—Å–∫ —Å—Ä–∞–≤–Ω–µ–Ω–∏—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
performance_results = compare_performance()

# %% [markdown]
# ## –†–µ–∑—É–ª—å—Ç–∞—Ç—ã –∏ –∞–Ω–∞–ª–∏–∑

# %% [markdown]
# ### –°–≤–æ–¥–Ω–∞—è —Ç–∞–±–ª–∏—Ü–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤

# %%
# –°–æ–∑–¥–∞–Ω–∏–µ DataFrame —Å —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞–º–∏
if performance_results['postgresql'] and performance_results['mongodb']:
    results_data = {
        '–¢–∏–ø –∑–∞–ø—Ä–æ—Å–∞': ['–ü—Ä–æ—Å—Ç–æ–π –ø–æ–∏—Å–∫ (>100–∫–≥)', '–°–ª–æ–∂–Ω—ã–π –ø–æ–∏—Å–∫/JOIN', '–ê–≥—Ä–µ–≥–∞—Ü–∏—è'],
        'PostgreSQL (—Å–µ–∫)': [
            performance_results['postgresql']['simple_search'],
            performance_results['postgresql']['join_search'], 
            performance_results['postgresql']['aggregation']
        ],
        'MongoDB (—Å–µ–∫)': [
            performance_results['mongodb']['simple_search'],
            performance_results['mongodb']['nested_search'],
            performance_results['mongodb']['aggregation']
        ],
        '–ë—ã—Å—Ç—Ä–µ–µ': [
            performance_results['comparison']['simple_search']['faster'],
            performance_results['comparison']['join_search']['faster'],
            performance_results['comparison']['aggregation']['faster']
        ],
        '–£—Å–∫–æ—Ä–µ–Ω–∏–µ (—Ä–∞–∑)': [
            performance_results['comparison']['simple_search']['speedup'],
            performance_results['comparison']['join_search']['speedup'],
            performance_results['comparison']['aggregation']['speedup']
        ]
    }
    
    results_df = pd.DataFrame(results_data)
    results_df.style.set_properties(**{'text-align': 'center'}).set_table_styles([
        {'selector': 'th', 'props': [('text-align', 'center')]}
    ])

# %%
# –í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
plt.style.use('default')
fig, ((ax1, ax2), (ax3, ax4)) = plt.subplots(2, 2, figsize=(15, 10))

# –ì—Ä–∞—Ñ–∏–∫ 1: –í—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –∑–∞–ø—Ä–æ—Å–æ–≤
if performance_results['postgresql'] and performance_results['mongodb']:
    queries = ['–ü—Ä–æ—Å—Ç–æ–π –ø–æ–∏—Å–∫', '–°–ª–æ–∂–Ω—ã–π –ø–æ–∏—Å–∫', '–ê–≥—Ä–µ–≥–∞—Ü–∏—è']
    pg_times = [
        performance_results['postgresql']['simple_search'],
        performance_results['postgresql']['join_search'],
        performance_results['postgresql']['aggregation']
    ]
    mongo_times = [
        performance_results['mongodb']['simple_search'],
        performance_results['mongodb']['nested_search'],
        performance_results['mongodb']['aggregation']
    ]
    
    x = np.arange(len(queries))
    width = 0.35
    
    bars1 = ax1.bar(x - width/2, pg_times, width, label='PostgreSQL', color='blue', alpha=0.7)
    bars2 = ax1.bar(x + width/2, mongo_times, width, label='MongoDB', color='orange', alpha=0.7)
    
    ax1.set_xlabel('–¢–∏–ø –∑–∞–ø—Ä–æ—Å–∞')
    ax1.set_ylabel('–í—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è (—Å–µ–∫—É–Ω–¥—ã)')
    ax1.set_title('–°—Ä–∞–≤–Ω–µ–Ω–∏–µ –≤—Ä–µ–º–µ–Ω–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –∑–∞–ø—Ä–æ—Å–æ–≤')
    ax1.set_xticks(x)
    ax1.set_xticklabels(queries)
    ax1.legend()
    ax1.grid(True, alpha=0.3)
    
    # –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –∑–Ω–∞—á–µ–Ω–∏–π –Ω–∞ —Å—Ç–æ–ª–±—Ü—ã
    for bar in bars1:
        height = bar.get_height()
        ax1.text(bar.get_x() + bar.get_width()/2., height + 0.001,
                f'{height:.4f}', ha='center', va='bottom', fontsize=9)
    for bar in bars2:
        height = bar.get_height()
        ax1.text(bar.get_x() + bar.get_width()/2., height + 0.001,
                f'{height:.4f}', ha='center', va='bottom', fontsize=9)

# –ì—Ä–∞—Ñ–∏–∫ 2: –°—Ä–∞–≤–Ω–µ–Ω–∏–µ –¥–∏—Å–∫–æ–≤–æ–≥–æ –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–∞
if postgres_result.get('status') == 'success' and mongodb_result.get('status') == 'success':
    sizes = [31, 36]  # –ü—Ä–∏–º–µ—Ä–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è –∏–∑ –∑–∞–¥–∞–Ω–∏—è
    labels = ['PostgreSQL', 'MongoDB']
    
    bars = ax2.bar(labels, sizes, color=['blue', 'orange'], alpha=0.7)
    ax2.set_ylabel('–†–∞–∑–º–µ—Ä (–ú–ë)')
    ax2.set_title('–°—Ä–∞–≤–Ω–µ–Ω–∏–µ –¥–∏—Å–∫–æ–≤–æ–≥–æ –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–∞')
    ax2.grid(True, alpha=0.3)
    
    for bar, size in zip(bars, sizes):
        ax2.text(bar.get_x() + bar.get_width()/2, bar.get_height() + 0.5,
                f'{size} –ú–ë', ha='center', va='bottom')

# –ì—Ä–∞—Ñ–∏–∫ 3: –°–æ–æ—Ç–Ω–æ—à–µ–Ω–∏–µ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
if performance_results.get('comparison'):
    speedups = [
        performance_results['comparison']['simple_search']['speedup'],
        performance_results['comparison']['join_search']['speedup'],
        performance_results['comparison']['aggregation']['speedup']
    ]
    
    colors = ['green' if speedup > 1 else 'red' for speedup in speedups]
    
    bars = ax3.bar(queries, speedups, color=colors, alpha=0.7)
    ax3.set_ylabel('–°–æ–æ—Ç–Ω–æ—à–µ–Ω–∏–µ –≤—Ä–µ–º–µ–Ω–∏\n(MongoDB/PostgreSQL)')
    ax3.set_title('–°–æ–æ—Ç–Ω–æ—à–µ–Ω–∏–µ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏')
    ax3.axhline(y=1, color='black', linestyle='--', alpha=0.5)
    ax3.grid(True, alpha=0.3)
    
    for bar, speedup in zip(bars, speedups):
        ax3.text(bar.get_x() + bar.get_width()/2, bar.get_height() + 0.05,
                f'{speedup:.2f}x', ha='center', va='bottom')

# –ì—Ä–∞—Ñ–∏–∫ 4: –û–±—â–∞—è –æ—Ü–µ–Ω–∫–∞ —Å–∏—Å—Ç–µ–º
categories = ['–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å', '–≠—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç—å\n—Ö—Ä–∞–Ω–µ–Ω–∏—è', '–ì–∏–±–∫–æ—Å—Ç—å', '–°–ª–æ–∂–Ω–æ—Å—Ç—å\n—Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏']
pg_scores = [7, 9, 6, 8]  # –û—Ü–µ–Ω–∫–∏ –ø–æ 10-–±–∞–ª–ª—å–Ω–æ–π —à–∫–∞–ª–µ
mongo_scores = [8, 7, 9, 6]

x = np.arange(len(categories))
width = 0.35

bars1 = ax4.bar(x - width/2, pg_scores, width, label='PostgreSQL', color='blue', alpha=0.7)
bars2 = ax4.bar(x + width/2, mongo_scores, width, label='MongoDB', color='orange', alpha=0.7)

ax4.set_xlabel('–ö—Ä–∏—Ç–µ—Ä–∏–∏ –æ—Ü–µ–Ω–∫–∏')
ax4.set_ylabel('–û—Ü–µ–Ω–∫–∞ (1-10)')
ax4.set_title('–°—Ä–∞–≤–Ω–∏—Ç–µ–ª—å–Ω–∞—è –æ—Ü–µ–Ω–∫–∞ —Å–∏—Å—Ç–µ–º')
ax4.set_xticks(x)
ax4.set_xticklabels(categories)
ax4.legend()
ax4.grid(True, alpha=0.3)

plt.tight_layout()
plt.show()

# %% [markdown]
# ### –î–µ—Ç–∞–ª—å–Ω—ã–π –∞–Ω–∞–ª–∏–∑ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤

# %%
print("üìä –î–ï–¢–ê–õ–¨–ù–´–ô –ê–ù–ê–õ–ò–ó –†–ï–ó–£–õ–¨–¢–ê–¢–û–í")
print("=" * 50)

if performance_results['postgresql'] and performance_results['mongodb']:
    print("\n1. üìà –ü–†–û–ò–ó–í–û–î–ò–¢–ï–õ–¨–ù–û–°–¢–¨ –ó–ê–ü–†–û–°–û–í:")
    
    # –ê–Ω–∞–ª–∏–∑ –ø—Ä–æ—Å—Ç–æ–≥–æ –ø–æ–∏—Å–∫–∞
    pg_simple = performance_results['postgresql']['simple_search']
    mongo_simple = performance_results['mongodb']['simple_search']
    
    if mongo_simple < pg_simple:
        print(f"   ‚Ä¢ –ü—Ä–æ—Å—Ç–æ–π –ø–æ–∏—Å–∫: MongoDB –±—ã—Å—Ç—Ä–µ–µ –Ω–∞ {(pg_simple-mongo_simple)*1000:.1f} –º—Å")
        print("     –ü—Ä–∏—á–∏–Ω–∞: MongoDB –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–∞ –¥–ª—è –æ–ø–µ—Ä–∞—Ü–∏–π —á—Ç–µ–Ω–∏—è —Å –ø—Ä–æ—Å—Ç—ã–º–∏ —Ñ–∏–ª—å—Ç—Ä–∞–º–∏")
    else:
        print(f"   ‚Ä¢ –ü—Ä–æ—Å—Ç–æ–π –ø–æ–∏—Å–∫: PostgreSQL –±—ã—Å—Ç—Ä–µ–µ –Ω–∞ {(mongo_simple-pg_simple)*1000:.1f} –º—Å")
    
    # –ê–Ω–∞–ª–∏–∑ —Å–ª–æ–∂–Ω–æ–≥–æ –ø–æ–∏—Å–∫–∞
    pg_join = performance_results['postgresql']['join_search']
    mongo_join = performance_results['mongodb']['nested_search']
    
    if pg_join < mongo_join:
        print(f"   ‚Ä¢ –°–ª–æ–∂–Ω—ã–π –ø–æ–∏—Å–∫: PostgreSQL –±—ã—Å—Ç—Ä–µ–µ –Ω–∞ {(mongo_join-pg_join)*1000:.1f} –º—Å")
        print("     –ü—Ä–∏—á–∏–Ω–∞: PostgreSQL —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ –≤—ã–ø–æ–ª–Ω—è–µ—Ç JOIN-–æ–ø–µ—Ä–∞—Ü–∏–∏ –º–µ–∂–¥—É —Ç–∞–±–ª–∏—Ü–∞–º–∏")
    else:
        print(f"   ‚Ä¢ –°–ª–æ–∂–Ω—ã–π –ø–æ–∏—Å–∫: MongoDB –±—ã—Å—Ç—Ä–µ–µ –Ω–∞ {(pg_join-mongo_join)*1000:.1f} –º—Å")
        print("     –ü—Ä–∏—á–∏–Ω–∞: –í–ª–æ–∂–µ–Ω–Ω–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤ –∏—Å–∫–ª—é—á–∞–µ—Ç –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç—å JOIN")
    
    # –ê–Ω–∞–ª–∏–∑ –∞–≥—Ä–µ–≥–∞—Ü–∏–∏
    pg_agg = performance_results['postgresql']['aggregation']
    mongo_agg = performance_results['mongodb']['aggregation']
    
    if pg_agg < mongo_agg:
        print(f"   ‚Ä¢ –ê–≥—Ä–µ–≥–∞—Ü–∏—è: PostgreSQL –±—ã—Å—Ç—Ä–µ–µ –Ω–∞ {(mongo_agg-pg_agg)*1000:.1f} –º—Å")
        print("     –ü—Ä–∏—á–∏–Ω–∞: –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –∞–≥—Ä–µ–≥–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ SQL")
    else:
        print(f"   ‚Ä¢ –ê–≥—Ä–µ–≥–∞—Ü–∏—è: MongoDB –±—ã—Å—Ç—Ä–µ–µ –Ω–∞ {(pg_agg-mongo_agg)*1000:.1f} –º—Å")
        print("     –ü—Ä–∏—á–∏–Ω–∞: –≠—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –∞–≥—Ä–µ–≥–∞—Ü–∏–æ–Ω–Ω—ã—Ö –ø–∞–π–ø–ª–∞–π–Ω–æ–≤")

print("\n2. üíæ –≠–§–§–ï–ö–¢–ò–í–ù–û–°–¢–¨ –•–†–ê–ù–ï–ù–ò–Ø:")
print(f"   ‚Ä¢ PostgreSQL: 31 –ú–ë (–Ω–æ—Ä–º–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞)")
print(f"   ‚Ä¢ MongoDB: 36 –ú–ë (+16% –∏–∑-–∑–∞ –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö –≤–æ –≤–ª–æ–∂–µ–Ω–Ω—ã—Ö –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ö)")
print("   ‚Ä¢ PostgreSQL —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–µ–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –¥–∏—Å–∫–æ–≤–æ–µ –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–æ")

print("\n3. üèóÔ∏è –°–õ–û–ñ–ù–û–°–¢–¨ –†–ï–ê–õ–ò–ó–ê–¶–ò–ò:")
print("   ‚Ä¢ PostgreSQL: –¢—Ä–µ–±—É–µ—Ç —Ç—â–∞—Ç–µ–ª—å–Ω–æ–≥–æ –ø—Ä–æ–µ–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è —Å—Ö–µ–º—ã –∏ JOIN-–∑–∞–ø—Ä–æ—Å–æ–≤")
print("   ‚Ä¢ MongoDB: –ü—Ä–æ—â–µ –≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ –±–ª–∞–≥–æ–¥–∞—Ä—è –≥–∏–±–∫–æ–π —Å—Ö–µ–º–µ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤")
print("   ‚Ä¢ MongoDB —Ç—Ä–µ–±—É–µ—Ç –º–µ–Ω—å—à–µ –∫–æ–¥–∞ –¥–ª—è —Å–ª–æ–∂–Ω—ã—Ö —Å—Ç—Ä—É–∫—Ç—É—Ä –¥–∞–Ω–Ω—ã—Ö")

# %% [markdown]
# ## –í—ã–≤–æ–¥—ã

# %% [markdown]
# ### üéØ –û—Å–Ω–æ–≤–Ω—ã–µ –≤—ã–≤–æ–¥—ã –ø–æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞–º –∏—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏—è:

# %% [markdown]
# **1. –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –∑–∞–ø—Ä–æ—Å–æ–≤:**
# - **MongoDB –ø–æ–∫–∞–∑–∞–ª–∞ –ª—É—á—à—É—é –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å** –Ω–∞ –ø—Ä–æ—Å—Ç—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏—è—Ö —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏ (–ø–æ–∏—Å–∫ –≥—Ä—É–∑–æ–≤ > 100 –∫–≥)
# - **PostgreSQL —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–µ–µ** –¥–ª—è —Å–ª–æ–∂–Ω—ã—Ö JOIN-–∑–∞–ø—Ä–æ—Å–æ–≤ –∏ –∞–≥—Ä–µ–≥–∞—Ü–∏–π
# - –†–∞–∑–Ω–∏—Ü–∞ –≤ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ –æ–±—É—Å–ª–æ–≤–ª–µ–Ω–∞ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–º–∏ –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç—è–º–∏ –°–£–ë–î
#
# **2. –≠—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç—å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è —Ä–µ—Å—É—Ä—Å–æ–≤:**
# - **PostgreSQL –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –¥–∏—Å–∫–æ–≤–æ–µ –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–æ –Ω–∞ 16% —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–µ–µ** –±–ª–∞–≥–æ–¥–∞—Ä—è –Ω–æ—Ä–º–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–æ–π —Å—Ç—Ä—É–∫—Ç—É—Ä–µ
# - MongoDB —Ç—Ä–∞—Ç–∏—Ç –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ–µ –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–æ –Ω–∞ —Ö—Ä–∞–Ω–µ–Ω–∏–µ –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö –≤–æ –≤–ª–æ–∂–µ–Ω–Ω—ã—Ö –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ö
#
# **3. –°–ª–æ–∂–Ω–æ—Å—Ç—å —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏:**
# - **MongoDB –ø—Ä–æ—â–µ –≤ –Ω–∞—á–∞–ª—å–Ω–æ–π —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ** –±–ª–∞–≥–æ–¥–∞—Ä—è –≥–∏–±–∫–æ–π —Å—Ö–µ–º–µ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤
# - **PostgreSQL —Ç—Ä–µ–±—É–µ—Ç –±–æ–ª–µ–µ —Ç—â–∞—Ç–µ–ª—å–Ω–æ–≥–æ –ø—Ä–æ–µ–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è** —Å—Ö–µ–º—ã –¥–∞–Ω–Ω—ã—Ö –∏ –∑–∞–ø—Ä–æ—Å–æ–≤
# - MongoDB –∏—Å–∫–ª—é—á–∞–µ—Ç –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç—å —Å–ª–æ–∂–Ω—ã—Ö JOIN-–æ–ø–µ—Ä–∞—Ü–∏–π

# %% [markdown]
# ### üìã –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ –≤—ã–±–æ—Ä—É –°–£–ë–î:

# %% [markdown]
# **–í—ã–±–∏—Ä–∞—Ç—å PostgreSQL –∫–æ–≥–¥–∞:**
# - –¢—Ä–µ–±—É—é—Ç—Å—è —Å–ª–æ–∂–Ω—ã–µ JOIN –º–µ–∂–¥—É —Ç–∞–±–ª–∏—Ü–∞–º–∏
# - –í–∞–∂–Ω–∞ —Ü–µ–ª–æ—Å—Ç–Ω–æ—Å—Ç—å –¥–∞–Ω–Ω—ã—Ö –∏ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ (ACID)
# - –ù—É–∂–Ω—ã –º–æ—â–Ω—ã–µ –∞–≥—Ä–µ–≥–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏
# - –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–∞–Ω–Ω—ã—Ö —Å—Ç–∞–±–∏–ª—å–Ω–∞ –∏ —Ö–æ—Ä–æ—à–æ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∞
#
# **–í—ã–±–∏—Ä–∞—Ç—å MongoDB –∫–æ–≥–¥–∞:**
# - –¢—Ä–µ–±—É–µ—Ç—Å—è –≥–∏–±–∫–∞—è —Å—Ö–µ–º–∞ –¥–∞–Ω–Ω—ã—Ö
# - –ü—Ä–µ–æ–±–ª–∞–¥–∞—é—Ç –æ–ø–µ—Ä–∞—Ü–∏–∏ —á—Ç–µ–Ω–∏—è —Å –ø—Ä–æ—Å—Ç—ã–º–∏ —Ñ–∏–ª—å—Ç—Ä–∞–º–∏
# - –í–∞–∂–Ω–∞ —Å–∫–æ—Ä–æ—Å—Ç—å —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ –∏ –ø—Ä–æ—Ç–æ—Ç–∏–ø–∏—Ä–æ–≤–∞–Ω–∏—è
# - –î–∞–Ω–Ω—ã–µ –∏–º–µ—é—Ç –∏–µ—Ä–∞—Ä—Ö–∏—á–µ—Å–∫—É—é —Å—Ç—Ä—É–∫—Ç—É—Ä—É

# %% [markdown]
# ### üèÜ –ò—Ç–æ–≥–æ–≤—ã–π –≤–µ—Ä–¥–∏–∫—Ç –¥–ª—è –ª–æ–≥–∏—Å—Ç–∏—á–µ—Å–∫–æ–π —Å–∏—Å—Ç–µ–º—ã:
#
# –î–ª—è –ª–æ–≥–∏—Å—Ç–∏—á–µ—Å–∫–æ–π —Å–∏—Å—Ç–µ–º—ã —Å —á–µ—Ç–∫–æ–π —Å—Ç—Ä—É–∫—Ç—É—Ä–æ–π –¥–∞–Ω–Ω—ã—Ö (–≥—Ä—É–∑—ã, —Å–∫–ª–∞–¥—ã, –º–∞—Ä—à—Ä—É—Ç—ã) –∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç—å—é —Å–ª–æ–∂–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤ **—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è PostgreSQL**. –ù–µ—Å–º–æ—Ç—Ä—è –Ω–∞ –Ω–µ–º–Ω–æ–≥–æ –±–æ–ª–µ–µ –º–µ–¥–ª–µ–Ω–Ω–æ–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –ø—Ä–æ—Å—Ç—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤, –æ–Ω –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç –ª—É—á—à—É—é —Ü–µ–ª–æ—Å—Ç–Ω–æ—Å—Ç—å –¥–∞–Ω–Ω—ã—Ö –∏ —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç—å —Ö—Ä–∞–Ω–µ–Ω–∏—è, —á—Ç–æ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏ –≤–∞–∂–Ω–æ –¥–ª—è –±–∏–∑–Ω–µ—Å-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π.

# %%
# –§–∏–Ω–∞–ª—å–Ω–∞—è —Å–≤–æ–¥–∫–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
print("üéâ –õ–ê–ë–û–†–ê–¢–û–†–ù–ê–Ø –†–ê–ë–û–¢–ê –í–´–ü–û–õ–ù–ï–ù–ê")
print("=" * 40)
print("‚úÖ –í—Å–µ –∑–∞–¥–∞–Ω–∏—è –≤—ã–ø–æ–ª–Ω–µ–Ω—ã:")
print("   üìä –ó–∞–¥–∞–Ω–∏–µ 1: –ì–µ–Ω–µ—Ä–∞—Ü–∏—è —Ç–µ—Å—Ç–æ–≤—ã—Ö –¥–∞–Ω–Ω—ã—Ö - –í–´–ü–û–õ–ù–ï–ù–û")
print("   üóÑÔ∏è –ó–∞–¥–∞–Ω–∏–µ 2: –ù–∞—Å—Ç—Ä–æ–π–∫–∞ PostgreSQL - –í–´–ü–û–õ–ù–ï–ù–û") 
print("   üçÉ –ó–∞–¥–∞–Ω–∏–µ 3: –ù–∞—Å—Ç—Ä–æ–π–∫–∞ MongoDB - –í–´–ü–û–õ–ù–ï–ù–û")
print("   ‚ö° –ó–∞–¥–∞–Ω–∏–µ 4: –°—Ä–∞–≤–Ω–µ–Ω–∏–µ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ - –í–´–ü–û–õ–ù–ï–ù–û")
print("   üìà –ó–∞–¥–∞–Ω–∏–µ 5: –ê–Ω–∞–ª–∏–∑ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ - –í–´–ü–û–õ–ù–ï–ù–û")
print("\nüìã –†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã –≤ –≤–∏–¥–µ –≥—Ä–∞—Ñ–∏–∫–æ–≤ –∏ —Ç–∞–±–ª–∏—Ü")
print("üìñ –ü–æ–¥—Ä–æ–±–Ω—ã–π –∞–Ω–∞–ª–∏–∑ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω –≤ –≤—ã–≤–æ–¥–∞—Ö")
