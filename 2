# Очистка данных
df_clean = df.copy()

# 1. Удаляем отмененные заказы (где InvoiceNo начинается с 'C')
df_clean = df_clean[~df_clean['InvoiceNo'].astype(str).str.startswith('C', na=False)]

# 2. Удаляем возвраты (отрицательные Quantity)
df_clean = df_clean[df_clean['Quantity'] > 0]

# 3. Удаляем строки с пропущенными Description
df_clean = df_clean[df_clean['Description'].notna()]

# 4. Удаляем строки с пропущенным Quantity
df_clean = df_clean[df_clean['Quantity'].notna()]

# 5. Преобразуем Quantity в числовой формат
df_clean['Quantity'] = pd.to_numeric(df_clean['Quantity'], errors='coerce')
df_clean = df_clean.dropna(subset=['Quantity'])

# 6. Заполняем пропущенные CustomerID
df_clean['CustomerID'] = df_clean['CustomerID'].fillna('Unknown')

# 7. Заполняем пропущенные Country (если есть)
if 'Country' in df_clean.columns:
    df_clean['Country'] = df_clean['Country'].fillna('Unknown')

print(f"Количество строк после очистки: {len(df_clean)}")
print(f"Количество уникальных товаров: {df_clean['Description'].nunique()}")
print(f"Количество уникальных клиентов: {df_clean['CustomerID'].nunique()}")
print(f"Общее количество проданных единиц: {df_clean['Quantity'].sum():,}")
