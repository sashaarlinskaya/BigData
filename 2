import pandas as pd
import numpy as np
from datetime import datetime, timedelta
import json
import os

def generate_logistics_data():
    """–ì–µ–Ω–µ—Ä–∞—Ü–∏—è —Ç–µ—Å—Ç–æ–≤—ã—Ö –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –ª–æ–≥–∏—Å—Ç–∏—á–µ—Å–∫–æ–π —Å–∏—Å—Ç–µ–º—ã"""
    np.random.seed(42)
    
    # –ü–∞—Ä–∞–º–µ—Ç—Ä—ã –¥–∞–Ω–Ω—ã—Ö
    n_shipments = 100000
    n_warehouses = 100
    n_routes = 500
    
    print("üìä –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –ª–æ–≥–∏—Å—Ç–∏—á–µ—Å–∫–∏—Ö –¥–∞–Ω–Ω—ã—Ö...")
    
    # –ì–µ–Ω–µ—Ä–∞—Ü–∏—è —Å–∫–ª–∞–¥–æ–≤
    cities = ['–ú–æ—Å–∫–≤–∞', '–°–∞–Ω–∫—Ç-–ü–µ—Ç–µ—Ä–±—É—Ä–≥', '–ù–æ–≤–æ—Å–∏–±–∏—Ä—Å–∫', '–ï–∫–∞—Ç–µ—Ä–∏–Ω–±—É—Ä–≥', '–ö–∞–∑–∞–Ω—å']
    warehouse_types = ['–¶–µ–Ω—Ç—Ä–∞–ª—å–Ω—ã–π', '–†–µ–≥–∏–æ–Ω–∞–ª—å–Ω—ã–π', '–õ–æ–∫–∞–ª—å–Ω—ã–π', '–¢—Ä–∞–Ω–∑–∏—Ç–Ω—ã–π']
    
    warehouses_data = []
    for i in range(n_warehouses):
        warehouses_data.append({
            'id': i,
            'name': f"–°–∫–ª–∞–¥_{i:03d}",
            'city': np.random.choice(cities),
            'type': np.random.choice(warehouse_types),
            'capacity': np.random.randint(1000, 50000),
            'employees': np.random.randint(5, 200),
            'latitude': round(np.random.uniform(55.0, 58.0), 6),
            'longitude': round(np.random.uniform(37.0, 40.0), 6)
        })
    
    # –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –º–∞—Ä—à—Ä—É—Ç–æ–≤
    transport_types = ['–ì—Ä—É–∑–æ–≤–∏–∫', '–§—É—Ä–∞', '–†–µ—Ñ—Ä–∏–∂–µ—Ä–∞—Ç–æ—Ä', '–ö–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤–æ–∑']
    
    routes_data = []
    for i in range(n_routes):
        start_city = np.random.choice(cities)
        end_city = np.random.choice([c for c in cities if c != start_city])
        distance = np.random.randint(100, 2000)
        
        routes_data.append({
            'id': i,
            'name': f"–ú–∞—Ä—à—Ä—É—Ç_{i:03d}: {start_city}-{end_city}",
            'start_city': start_city,
            'end_city': end_city,
            'distance': distance,
            'duration_hours': distance // 60,
            'transport_type': np.random.choice(transport_types),
            'status': np.random.choice(['–ê–∫—Ç–∏–≤–µ–Ω', '–ù–µ–∞–∫—Ç–∏–≤–µ–Ω'], p=[0.8, 0.2]),
            'cost_per_km': round(np.random.uniform(10, 50), 2)
        })
    
    # –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –≥—Ä—É–∑–æ–≤
    start_date = datetime(2023, 1, 1)
    shipment_statuses = ['–í –æ–±—Ä–∞–±–æ—Ç–∫–µ', '–í –ø—É—Ç–∏', '–î–æ—Å—Ç–∞–≤–ª–µ–Ω', '–ó–∞–¥–µ—Ä–∂–∞–Ω']
    
    shipments_data = []
    for i in range(n_shipments):
        warehouse_from = np.random.randint(0, n_warehouses)
        warehouse_to = np.random.randint(0, n_warehouses)
        
        while warehouse_to == warehouse_from:
            warehouse_to = np.random.randint(0, n_warehouses)
        
        shipments_data.append({
            'id': i,
            'tracking_number': f"TRK{i:08d}",
            'warehouse_from_id': warehouse_from,
            'warehouse_to_id': warehouse_to,
            'route_id': np.random.randint(0, n_routes),
            'weight': round(np.random.uniform(1, 1000), 2),
            'volume': round(np.random.uniform(0.1, 10), 2),
            'value': round(np.random.uniform(100, 50000), 2),
            'shipment_date': (start_date + timedelta(days=np.random.randint(0, 365))).isoformat(),
            'delivery_date': (start_date + timedelta(days=np.random.randint(1, 380))).isoformat(),
            'status': np.random.choice(shipment_statuses, p=[0.2, 0.3, 0.4, 0.1]),
            'type': np.random.choice(['–•—Ä—É–ø–∫–∏–π', '–û–ø–∞—Å–Ω—ã–π', '–°–∫–æ—Ä–æ–ø–æ—Ä—Ç—è—â–∏–π—Å—è', '–û–±—ã—á–Ω—ã–π']),
            'priority': np.random.choice(['–ù–∏–∑–∫–∏–π', '–°—Ä–µ–¥–Ω–∏–π', '–í—ã—Å–æ–∫–∏–π'], p=[0.6, 0.3, 0.1])
        })
    
    # –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ JSON
    data = {
        'metadata': {
            'generated_at': datetime.now().isoformat(),
            'n_shipments': n_shipments,
            'n_warehouses': n_warehouses,
            'n_routes': n_routes
        },
        'warehouses': warehouses_data,
        'routes': routes_data,
        'shipments': shipments_data
    }
    
    os.makedirs('data', exist_ok=True)
    with open('data/01_generated_data.json', 'w', encoding='utf-8') as f:
        json.dump(data, f, ensure_ascii=False, indent=2)
    
    print("‚úÖ –î–∞–Ω–Ω—ã–µ —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω—ã –∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã –≤ data/01_generated_data.json")
    
    # –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
    print(f"üì¶ –°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–æ:")
    print(f"   - –°–∫–ª–∞–¥—ã: {len(warehouses_data):,}")
    print(f"   - –ú–∞—Ä—à—Ä—É—Ç—ã: {len(routes_data):,}")
    print(f"   - –ì—Ä—É–∑—ã: {len(shipments_data):,}")
    
    return data

if __name__ == "__main__":
    generate_logistics_data()
