import subprocess
import sys
import os

def run_etap(etap_number, script_name, description=""):
    """–ó–∞–ø—É—Å–∫ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ —ç—Ç–∞–ø–∞"""
    print(f"\n{'='*60}")
    print(f"üöÄ –≠–¢–ê–ü {etap_number}: {description}")
    print(f"üìù –°–∫—Ä–∏–ø—Ç: {script_name}")
    print(f"{'='*60}")
    
    try:
        result = subprocess.run([sys.executable, script_name], check=True)
        if result.returncode == 0:
            print(f"‚úÖ –≠—Ç–∞–ø {etap_number} –∑–∞–≤–µ—Ä—à–µ–Ω —É—Å–ø–µ—à–Ω–æ")
        return True
    except subprocess.CalledProcessError as e:
        print(f"‚ùå –û—à–∏–±–∫–∞ –Ω–∞ —ç—Ç–∞–ø–µ {etap_number}: {e}")
        return False

def main():
    """–ì–ª–∞–≤–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –¥–ª—è –∑–∞–ø—É—Å–∫–∞ –≤—Å–µ—Ö —ç—Ç–∞–ø–æ–≤"""
    
    print("üì¶ –°–†–ê–í–ù–ï–ù–ò–ï POSTGRESQL –ò MONGODB –î–õ–Ø –õ–û–ì–ò–°–¢–ò–ß–ï–°–ö–û–ô –°–ò–°–¢–ï–ú–´")
    print("=" * 70)
    print("üîß –í–µ—Ä—Å–∏—è —Å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–º–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è")
    print("=" * 70)
    print("üìä –ü–∞—Ä–∞–º–µ—Ç—Ä—ã –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è:")
    print("   - PostgreSQL: studpg/student@postgresql:5432")
    print("   - MongoDB: studmongo/mongouser@localhost:27017")
    print("=" * 70)
    
    # –°–æ–∑–¥–∞–Ω–∏–µ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ –¥–ª—è –¥–∞–Ω–Ω—ã—Ö
    os.makedirs('data', exist_ok=True)
    
    # –≠—Ç–∞–ø—ã –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è
    stages = [
        (1, "01_data_generation.py", "–ì–µ–Ω–µ—Ä–∞—Ü–∏—è —Ç–µ—Å—Ç–æ–≤—ã—Ö –¥–∞–Ω–Ω—ã—Ö"),
        (2, "02_postgres_setup.py", "–ù–∞—Å—Ç—Ä–æ–π–∫–∞ PostgreSQL"),
        (3, "03_mongodb_setup.py", "–ù–∞—Å—Ç—Ä–æ–π–∫–∞ MongoDB"),
        (4, "04_performance_comparison.py", "–°—Ä–∞–≤–Ω–µ–Ω–∏–µ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏"),
        (5, "05_visualization.py", "–í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤")
    ]
    
    # –ó–∞–ø—É—Å–∫ –≤—Å–µ—Ö —ç—Ç–∞–ø–æ–≤
    for etap_number, script_name, description in stages:
        success = run_etap(etap_number, script_name, description)
        if not success:
            print(f"\n‚ö†Ô∏è –ü—Ä–æ–±–ª–µ–º–∞ –Ω–∞ —ç—Ç–∞–ø–µ {etap_number}, –ø—Ä–æ–¥–æ–ª–∂–∞–µ–º...")
    
    print(f"\nüéâ –í–°–ï –≠–¢–ê–ü–´ –ó–ê–í–ï–†–®–ï–ù–´!")
    print("üìÅ –†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã –≤ –ø–∞–ø–∫–µ 'data/':")
    print("   - 01_generated_data.json - –∏—Å—Ö–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ")
    print("   - 02_postgres_metadata.json - –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ PostgreSQL")
    print("   - 03_mongodb_metadata.json - –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ MongoDB") 
    print("   - 04_performance_comparison.json - —Å—Ä–∞–≤–Ω–µ–Ω–∏–µ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏")
    print("   - 05_summary_report.json - —Å–≤–æ–¥–Ω—ã–π –æ—Ç—á–µ—Ç")
    print("   - 05_comparison_visualization.png - –≥—Ä–∞—Ñ–∏–∫–∏ —Å—Ä–∞–≤–Ω–µ–Ω–∏—è")

if __name__ == "__main__":
    main()
